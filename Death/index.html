<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEATH FAUCET TMWSTW</title>
</head>

<body>
    <h1> Deaths in The Man Who Sold The World Metaverse</h1>
    <h2>
        <p>total deaths on record <span id="totdeaths"></p> *subject to witness accounts</p>
        <input type="text" name="name" id="walletkdr" placeholder="wallet.eth to filter"><span id="kdr">
        <button type="button" id="button">K/D ratio!</button>
    </h2>
    <hr>
    <span id="plotter">
        <script defer>

            const apiReso = 'https://api.tmwstw.io/get_ens@' //ens resolv returns a nice text
            const apiUrl = 'https://api.tmwstw.io/game_death_list'; // death faucet tap that ~ !
            const inputBox = document.getElementById("walletkdr");
            const button = document.getElementById("button")
            button.style.display = 'none';
            inputBox.style.display = 'none'
            const causeOfDeath =
                [
                    'lack of skill basically',
                    'Fucked too hard by robot',
                    'Yesss',
                    'Narwhal laser attack',
                    'skill ?',
                    'stepped on a lego',
                    'tooo much strap',
                    'drown in salty tears',
                    'F A F O',
                    'had it on safety',
                    'whipped it out tooo slow',
                    'dummy just stood there',
                    'sheeeeeeeeeeeeiiiiitt',
                    'burgers on you next time',
                    'homey dont play dat',
                    'got got ',
                    'don got',
                    'heard a whistling in the distance',
                    'got ghosted',
                    'the count was wrong ',
                    '1st loser',
                    'wasnt first... clearly last now',
                    'Hit it on the first try',
                    'Peep the slow cutter',
                    'went pop like snot bubbles',
                ]

            async function getDeathApi() {
                const response = await fetch(apiUrl);
                const data = await response.json();
                return data.reverse()
            }

            async function walletRes(wallet_id) {
                const response = await fetch(apiReso + wallet_id);
                const data = await response.text();

                return data.toLocaleUpperCase() //MFDOOM! ALL CAPS
            }

            async function setPage() {
                const fixed_list = await getDeathApi()
                if (fixed_list.length == 0) { totdeaths.innerText = `no deaths bullets are FREE? api reset` }
                else {
                    totdeaths.innerText = `${fixed_list.length}`

                    for (let i = 0; i < fixed_list.length - 1; i++) {
                        //for (let i = 0; i < 25; i++) {
                        let words = causeOfDeath[Math.floor(Math.random() * causeOfDeath.length)];
                        let vic = await walletRes((fixed_list[i].victim))
                        let killer = await walletRes((fixed_list[i].killer))
                        plotter.innerHTML += `<h2>Victim- ` + vic + ':  ' + words + `</h2>` + `<h4>died on ` + fixed_list[i].date + ` local game time  </h4>` + `<h2>Killer- ` + killer + ': slinging that chopper' + `</h2><hr>`
                    }
                }
                inputBox.style.display = 'block'
                button.style.display = 'block'
            }
            button.addEventListener("click", function () {
                const textBox = inputBox.value.toLocaleUpperCase();
                const Ksearch = new RegExp('Killer- ' + textBox, 'gi');
                const Vsearch = new RegExp('Victim- ' + textBox, 'gi');
                let kRatio = document.querySelector("#plotter").textContent.match(Ksearch).length
                let dRatio = document.querySelector("#plotter").textContent.match(Vsearch).length
                //KD = kills / deaths0
                let kdRatio = (kRatio / dRatio).toFixed(3);
                kdr.innerHTML = `<h3>` + textBox + "  kdr: " + kRatio + " / " + dRatio + " = " + kdRatio + `</h3>`
                button.style.display = 'block'
            })
            setPage()

        </script>

        <style>
            html {
                margin: 10px;
                background-color: white;
            }

            body {
                padding: 10px;
                background-color: green;
            }

            h1 {
                color: black;
                margin-left: 48px;
                font-size: 48px;
            }

            h2 {
                color: white;
                background-color: green;
                font-size: 24px;
            }

            h4 {
                font-size: 24px;
                background-color: white;
                color: black;
            }
        </style>

</body>

</html>
