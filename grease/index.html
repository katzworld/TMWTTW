<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Time to get GREASE!</title>

    <!-- zimjs.com - JavaScript Canvas Framework -->

    <script type="module">
        import zim from "https://zimjs.org/cdn/016/zim_game";
        var Colors = [green, blue, brown, yellow, purple]
        var TextColors = [black, white, black, white, black, white, black, white, black, white]
        const backgroundcolor = pluck(Colors, true)
        // See Docs under Frame for FIT, FILL, FULL, and TAG
        new Frame(FULL, 1024, 768, backgroundcolor, dark, ready);
        function ready() {
            zog("Grease MAN!!");

            const timer = new Timer({
                time: 60,
                borderColor: pluck(Colors, true),
                isometric: LEFT,
                size: 84,
                bold: true,
                borderWidth: 12,
                height: 350,
                valign: "middle",
                align: "center",
            }).loc(1024, 50);

            const current_timesheet_url = 'https://clock.imamkatz.com/greasemark';
            const grease_api = 'https://api.tmwstw.io/faucet_state=grease'

            class Bouncer extends Container {
                constructor(container, centerColor = pluck(Colors), color = pluck(Colors), radius = 75, textcolor) {
                    super();
                    this.centerColor = centerColor;
                    this.color = color;
                    this.radius = radius;
                    this.textcolor = textcolor;
                    container.addChild(this);
                }
            }

            async("https://zimjs.org/cdn/jsonp.php?api=" + current_timesheet_url + "&callback=async.getData", getData);

            var greaseplats = []
            var blocknum = ''
            const xpos = rand(W / 3, W.max)
            const xposoffset = xpos + 50
            function getData(data) {
                blocknum = data[0];
                greaseplats = data[1].filter(item => parseInt(item.split(',')[1]) < 420); // Filter items < 420
                new Label('Block Number: ' + blocknum, 64, null, red).rot(rand(-90, 0)).center().mov(+100, 0);
                const clocks = new Container().addTo();
                loop(greaseplats.length, () => {
                    new Bouncer(clocks, pluck(Colors), pluck(TextColors), 100);
                });
                loop(clocks.children, (b, i) => {
                    b.text = 'plat#' + greaseplats[i].split(',')[0] + '    blocks+' + greaseplats[i].split(',')[1];

                    if (greaseplats[i].split(',')[1] < 187) {
                        b.centerColor = red;
                        b.textcolor = red;
                    } else {
                        if (greaseplats[i].split(',')[1] < 420) {
                            b.centerColor = orange;
                            b.textcolor = orange;
                        }
                    }
                });
            }

            async function get_grease() {
                const ypos = 50;
                new Label('ready');
            }
        }
    </script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
</head>

<body></body>

</html>